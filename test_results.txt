============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.1, pluggy-1.6.0 -- /home/fkeegan/src/haindy/venv/bin/python
cachedir: .pytest_cache
rootdir: /home/fkeegan/src/haindy
configfile: pytest.ini
testpaths: tests
plugins: anyio-4.9.0, asyncio-1.0.0, cov-6.2.1
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 385 items

tests/test_action_agent.py::TestActionAgentBasics::test_initialization PASSED [  0%]
tests/test_action_agent.py::TestActionAgentBasics::test_conversation_reset PASSED [  0%]
tests/test_action_agent.py::TestActionAgentBasics::test_execute_action_returns_result PASSED [  0%]
tests/test_action_agent.py::TestActionAgentBasics::test_execute_action_routes_correctly PASSED [  1%]
tests/test_action_agent.py::TestActionAgentBasics::test_determine_action_basic PASSED [  1%]
tests/test_action_agent.py::TestActionAgentIntegration::test_navigate_action_workflow PASSED [  1%]
tests/test_action_agent.py::TestActionAgentIntegration::test_error_handling_captures_exceptions PASSED [  1%]
tests/test_action_agent.py::TestActionAgentScrolling::test_scroll_action_routes_correctly PASSED [  2%]
tests/test_action_agent.py::TestActionAgentUtilities::test_create_overlay_image PASSED [  2%]
tests/test_action_agent.py::TestActionAgentUtilities::test_build_analysis_prompt PASSED [  2%]
tests/test_analytics.py::TestTestMetrics::test_metrics_creation PASSED   [  2%]
tests/test_analytics.py::TestTestMetrics::test_duration_calculation PASSED [  3%]
tests/test_analytics.py::TestTestMetrics::test_success_rate_calculation PASSED [  3%]
tests/test_analytics.py::TestTestMetrics::test_to_dict PASSED            [  3%]
tests/test_analytics.py::TestMetricsCollector::test_collector_initialization PASSED [  3%]
tests/test_analytics.py::TestMetricsCollector::test_start_test PASSED    [  4%]
tests/test_analytics.py::TestMetricsCollector::test_end_test PASSED      [  4%]
tests/test_analytics.py::TestMetricsCollector::test_record_step_outcome PASSED [  4%]
tests/test_analytics.py::TestMetricsCollector::test_record_api_call PASSED [  4%]
tests/test_analytics.py::TestMetricsCollector::test_record_browser_action PASSED [  5%]
tests/test_analytics.py::TestMetricsCollector::test_metric_summary PASSED [  5%]
tests/test_analytics.py::TestMetricsCollector::test_rate_calculation PASSED [  5%]
tests/test_analytics.py::TestMetricsCollector::test_test_summary PASSED  [  5%]
tests/test_analytics.py::TestMetricsCollector::test_performance_summary PASSED [  6%]
tests/test_analytics.py::TestMetricsCollector::test_reset PASSED         [  6%]
tests/test_analytics.py::TestConvenienceFunctions::test_global_functions PASSED [  6%]
tests/test_base_agent.py::TestBaseAgent::test_initialization PASSED      [  7%]
tests/test_base_agent.py::TestBaseAgent::test_default_initialization FAILED [  7%]
tests/test_base_agent.py::TestBaseAgent::test_client_lazy_loading FAILED [  7%]
tests/test_base_agent.py::TestBaseAgent::test_process_message_no_response_required PASSED [  7%]
tests/test_base_agent.py::TestBaseAgent::test_process_message_with_response PASSED [  8%]
tests/test_base_agent.py::TestBaseAgent::test_calculate_confidence_level PASSED [  8%]
tests/test_base_agent.py::TestBaseAgent::test_should_retry PASSED        [  8%]
tests/test_base_agent.py::TestBaseAgent::test_should_refine PASSED       [  8%]
tests/test_base_agent.py::TestBaseAgent::test_call_openai PASSED         [  9%]
tests/test_base_agent.py::TestBaseAgent::test_call_openai_with_overrides PASSED [  9%]
tests/test_base_agent.py::TestBaseAgent::test_build_messages_simple PASSED [  9%]
tests/test_base_agent.py::TestBaseAgent::test_build_messages_with_history PASSED [  9%]
tests/test_base_agent.py::TestBaseAgent::test_message_history_management PASSED [ 10%]
tests/test_browser_integration.py::TestBrowserIntegration::test_browser_lifecycle PASSED [ 10%]
tests/test_browser_integration.py::TestBrowserIntegration::test_context_manager PASSED [ 10%]
tests/test_browser_integration.py::TestBrowserIntegration::test_screenshot_with_grid PASSED [ 10%]
tests/test_browser_integration.py::TestBrowserIntegration::test_grid_click PASSED [ 11%]
tests/test_browser_integration.py::TestBrowserIntegration::test_refinement_region_screenshot PASSED [ 11%]
tests/test_browser_integration.py::TestBrowserIntegration::test_grid_initialization PASSED [ 11%]
tests/test_browser_integration.py::TestBrowserIntegration::test_multiple_navigation PASSED [ 11%]
tests/test_communication.py::TestMessageBus::test_register_agent PASSED  [ 12%]
tests/test_communication.py::TestMessageBus::test_unregister_agent PASSED [ 12%]
tests/test_communication.py::TestMessageBus::test_subscribe_unsubscribe PASSED [ 12%]
tests/test_communication.py::TestMessageBus::test_publish_broadcast PASSED [ 12%]
tests/test_communication.py::TestMessageBus::test_publish_targeted PASSED [ 13%]
tests/test_communication.py::TestMessageBus::test_publish_with_priority PASSED [ 13%]
tests/test_communication.py::TestMessageBus::test_get_messages_timeout PASSED [ 13%]
tests/test_communication.py::TestMessageBus::test_message_history PASSED [ 14%]
tests/test_communication.py::TestMessageBus::test_statistics PASSED      [ 14%]
tests/test_communication.py::TestMessageBus::test_clear_history PASSED   [ 14%]
tests/test_communication.py::TestMessageBus::test_sync_handler PASSED    [ 14%]
tests/test_communication.py::TestMessageBus::test_message_history_limit PASSED [ 15%]
tests/test_communication.py::TestMessageBus::test_unregistered_sender_warning PASSED [ 15%]
tests/test_communication.py::TestMessageBus::test_targeted_to_unregistered PASSED [ 15%]
tests/test_communication.py::TestMessageBus::test_shutdown PASSED        [ 15%]
tests/test_communication.py::TestMessageTypes::test_message_types_defined FAILED [ 16%]
tests/test_communication.py::TestMessagePriority::test_priority_levels PASSED [ 16%]
tests/test_config.py::TestSettings::test_default_settings PASSED         [ 16%]
tests/test_config.py::TestSettings::test_settings_from_env PASSED        [ 16%]
tests/test_config.py::TestSettings::test_log_level_validation PASSED     [ 17%]
tests/test_config.py::TestSettings::test_log_format_validation PASSED    [ 17%]
tests/test_config.py::TestSettings::test_numeric_validation PASSED       [ 17%]
tests/test_config.py::TestSettings::test_path_fields PASSED              [ 17%]
tests/test_config.py::TestSettings::test_create_directories PASSED       [ 18%]
tests/test_config.py::TestConfigManager::test_get_existing_key PASSED    [ 18%]
tests/test_config.py::TestConfigManager::test_get_missing_key PASSED     [ 18%]
tests/test_config.py::TestConfigManager::test_get_required_existing PASSED [ 18%]
tests/test_config.py::TestConfigManager::test_get_required_missing PASSED [ 19%]
tests/test_config.py::TestConfigManager::test_get_all PASSED             [ 19%]
tests/test_config.py::TestGetSettings::test_get_settings_loads_env PASSED [ 19%]
tests/test_config.py::TestGetSettings::test_get_settings_cached PASSED   [ 20%]
tests/test_coordinator.py::TestWorkflowCoordinatorBasics::test_initialize_creates_agents PASSED [ 20%]
tests/test_coordinator.py::TestWorkflowCoordinatorBasics::test_initialize_registers_agents PASSED [ 20%]
tests/test_coordinator.py::TestWorkflowCoordinatorBasics::test_get_active_tests PASSED [ 20%]
tests/test_coordinator.py::TestWorkflowCoordinatorTestExecution::test_generate_test_plan_method PASSED [ 21%]
tests/test_coordinator.py::TestWorkflowCoordinatorTestExecution::test_concurrent_test_limit_check PASSED [ 21%]
tests/test_coordinator.py::TestWorkflowCoordinatorTestControl::test_pause_resume_stop_messages PASSED [ 21%]
tests/test_coordinator.py::TestWorkflowCoordinatorTestControl::test_stop_test_cancels_task PASSED [ 21%]
tests/test_coordinator.py::TestWorkflowCoordinatorStateAndProgress::test_get_test_progress_basic SKIPPED [ 22%]
tests/test_coordinator.py::TestWorkflowCoordinatorStateAndProgress::test_get_coordinator_state_basic PASSED [ 22%]
tests/test_coordinator.py::TestWorkflowCoordinatorCleanup::test_cleanup_cancels_active_tests PASSED [ 22%]
tests/test_coordinator.py::TestWorkflowCoordinatorCleanup::test_shutdown_basic PASSED [ 22%]
tests/test_core_types.py::TestGridCoordinate::test_valid_coordinate PASSED [ 23%]
tests/test_core_types.py::TestGridCoordinate::test_default_offsets PASSED [ 23%]
tests/test_core_types.py::TestGridCoordinate::test_invalid_offsets PASSED [ 23%]
tests/test_core_types.py::TestGridCoordinate::test_invalid_confidence PASSED [ 23%]
tests/test_core_types.py::TestActionInstruction::test_click_instruction PASSED [ 24%]
tests/test_core_types.py::TestActionInstruction::test_type_instruction PASSED [ 24%]
tests/test_core_types.py::TestTestStep::test_create_step PASSED          [ 24%]
tests/test_core_types.py::TestTestStep::test_step_with_dependencies PASSED [ 24%]
tests/test_core_types.py::TestTestPlan::test_create_test_plan PASSED     [ 25%]
tests/test_core_types.py::TestTestState::test_initial_state PASSED       [ 25%]
tests/test_core_types.py::TestTestState::test_state_with_progress PASSED [ 25%]
tests/test_core_types.py::TestConfidenceLevel::test_confidence_levels PASSED [ 25%]
tests/test_core_types.py::TestActionResult::test_successful_result PASSED [ 26%]
tests/test_core_types.py::TestActionResult::test_failed_result PASSED    [ 26%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_load_scenario PASSED [ 26%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_load_scenario_missing_fields PASSED [ 27%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_main_with_requirements ERROR [ 27%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_main_with_scenario_file ERROR [ 27%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_main_plan_only_mode FAILED [ 27%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_main_with_timeout PASSED [ 28%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_test_reporter_integration ERROR [ 28%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_full_workflow_integration PASSED [ 28%]
tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_cli_help PASSED [ 28%]
tests/test_enhanced_error_reporting.py::TestBugReportCreation::test_create_bug_report_from_failed_step ERROR [ 29%]
tests/test_enhanced_error_reporting.py::TestBugReportCreation::test_no_bug_report_for_successful_step ERROR [ 29%]
tests/test_enhanced_error_reporting.py::TestBugReportCreation::test_bug_report_summary ERROR [ 29%]
tests/test_enhanced_error_reporting.py::TestSimpleHTMLReporter::test_generate_html_report ERROR [ 29%]
tests/test_enhanced_error_reporting.py::TestSimpleHTMLReporter::test_report_without_bugs ERROR [ 30%]
tests/test_enhanced_types.py::TestValidationResult::test_validation_result_creation PASSED [ 30%]
tests/test_enhanced_types.py::TestValidationResult::test_validation_result_with_failures PASSED [ 30%]
tests/test_enhanced_types.py::TestCoordinateResult::test_coordinate_result_creation PASSED [ 30%]
tests/test_enhanced_types.py::TestCoordinateResult::test_coordinate_result_with_refinement PASSED [ 31%]
tests/test_enhanced_types.py::TestExecutionResult::test_execution_success PASSED [ 31%]
tests/test_enhanced_types.py::TestExecutionResult::test_execution_failure PASSED [ 31%]
tests/test_enhanced_types.py::TestAIAnalysis::test_ai_analysis_creation PASSED [ 31%]
tests/test_enhanced_types.py::TestBrowserState::test_browser_state_creation PASSED [ 32%]
tests/test_enhanced_types.py::TestEnhancedActionResult::test_enhanced_result_creation PASSED [ 32%]
tests/test_enhanced_types.py::TestEnhancedActionResult::test_enhanced_result_full_success PASSED [ 32%]
tests/test_enhanced_types.py::TestEnhancedActionResult::test_enhanced_result_dict_compatibility PASSED [ 32%]
tests/test_enhanced_types.py::TestActionPattern::test_action_pattern_creation PASSED [ 33%]
tests/test_error_aggregator.py::TestErrorMetrics::test_metrics_initialization PASSED [ 33%]
tests/test_error_aggregator.py::TestErrorMetrics::test_update_metrics PASSED [ 33%]
tests/test_error_aggregator.py::TestErrorMetrics::test_recovery_rate PASSED [ 34%]
tests/test_error_aggregator.py::TestErrorMetrics::test_to_dict PASSED    [ 34%]
tests/test_error_aggregator.py::TestErrorReport::test_report_creation PASSED [ 34%]
tests/test_error_aggregator.py::TestErrorReport::test_report_to_dict PASSED [ 34%]
tests/test_error_aggregator.py::TestErrorReport::test_save_to_file PASSED [ 35%]
tests/test_error_aggregator.py::TestErrorAggregator::test_aggregator_initialization PASSED [ 35%]
tests/test_error_aggregator.py::TestErrorAggregator::test_add_error PASSED [ 35%]
tests/test_error_aggregator.py::TestErrorAggregator::test_error_categorization PASSED [ 35%]
tests/test_error_aggregator.py::TestErrorAggregator::test_critical_error_detection PASSED [ 36%]
tests/test_error_aggregator.py::TestErrorAggregator::test_recovery_summary PASSED [ 36%]
tests/test_error_aggregator.py::TestErrorAggregator::test_generate_recommendations PASSED [ 36%]
tests/test_error_aggregator.py::TestErrorAggregator::test_error_timeline PASSED [ 36%]
tests/test_error_aggregator.py::TestErrorAggregator::test_agent_error_summary PASSED [ 37%]
tests/test_error_aggregator.py::TestErrorAggregator::test_generate_full_report PASSED [ 37%]
tests/test_error_exceptions.py::TestHAINDYError::test_basic_creation PASSED [ 37%]
tests/test_error_exceptions.py::TestHAINDYError::test_with_details PASSED [ 37%]
tests/test_error_exceptions.py::TestHAINDYError::test_with_cause PASSED  [ 38%]
tests/test_error_exceptions.py::TestHAINDYError::test_to_dict PASSED     [ 38%]
tests/test_error_exceptions.py::TestRetryableError::test_default_retry_settings PASSED [ 38%]
tests/test_error_exceptions.py::TestRetryableError::test_custom_retry_settings PASSED [ 38%]
tests/test_error_exceptions.py::TestRetryableError::test_retry_counting PASSED [ 39%]
tests/test_error_exceptions.py::TestAgentError::test_agent_error_creation PASSED [ 39%]
tests/test_error_exceptions.py::TestBrowserError::test_browser_error_creation PASSED [ 39%]
tests/test_error_exceptions.py::TestBrowserError::test_browser_error_minimal PASSED [ 40%]
tests/test_error_exceptions.py::TestValidationError::test_validation_error PASSED [ 40%]
tests/test_error_exceptions.py::TestHallucinationError::test_hallucination_error PASSED [ 40%]
tests/test_error_exceptions.py::TestTimeoutError::test_timeout_error PASSED [ 40%]
tests/test_error_exceptions.py::TestCoordinationError::test_coordination_error PASSED [ 41%]
tests/test_error_recovery.py::TestRecoveryContext::test_context_creation PASSED [ 41%]
tests/test_error_recovery.py::TestRecoveryContext::test_elapsed_time PASSED [ 41%]
tests/test_error_recovery.py::TestRecoveryContext::test_is_retryable PASSED [ 41%]
tests/test_error_recovery.py::TestRecoveryContext::test_add_attempt PASSED [ 42%]
tests/test_error_recovery.py::TestExponentialBackoffStrategy::test_default_settings PASSED [ 42%]
tests/test_error_recovery.py::TestExponentialBackoffStrategy::test_delay_calculation_no_jitter PASSED [ 42%]
tests/test_error_recovery.py::TestExponentialBackoffStrategy::test_max_delay_cap PASSED [ 42%]
tests/test_error_recovery.py::TestExponentialBackoffStrategy::test_delay_with_jitter PASSED [ 43%]
tests/test_error_recovery.py::TestExponentialBackoffStrategy::test_should_retry_logic PASSED [ 43%]
tests/test_error_recovery.py::TestLinearBackoffStrategy::test_delay_calculation PASSED [ 43%]
tests/test_error_recovery.py::TestLinearBackoffStrategy::test_should_retry PASSED [ 43%]
tests/test_error_recovery.py::TestRecoveryManager::test_successful_operation PASSED [ 44%]
tests/test_error_recovery.py::TestRecoveryManager::test_retry_then_success PASSED [ 44%]
tests/test_error_recovery.py::TestRecoveryManager::test_non_retryable_error PASSED [ 44%]
tests/test_error_recovery.py::TestRecoveryManager::test_fallback_function PASSED [ 44%]
tests/test_error_recovery.py::TestRecoveryManager::test_fallback_failure PASSED [ 45%]
tests/test_error_recovery.py::TestRecoveryManager::test_timeout_handling PASSED [ 45%]
tests/test_error_recovery.py::TestRecoveryManager::test_custom_error_handler PASSED [ 45%]
tests/test_error_recovery.py::TestRecoveryManager::test_statistics_management PASSED [ 45%]
tests/test_error_validation.py::TestValidationResult::test_validation_result_creation PASSED [ 46%]
tests/test_error_validation.py::TestValidationResult::test_to_dict PASSED [ 46%]
tests/test_error_validation.py::TestConfidenceScorer::test_default_thresholds PASSED [ 46%]
tests/test_error_validation.py::TestConfidenceScorer::test_action_type_confidence PASSED [ 47%]
tests/test_error_validation.py::TestConfidenceScorer::test_calculate_action_confidence PASSED [ 47%]
tests/test_error_validation.py::TestConfidenceScorer::test_confidence_levels PASSED [ 47%]
tests/test_error_validation.py::TestHallucinationDetector::test_phantom_element_detection PASSED [ 47%]
tests/test_error_validation.py::TestHallucinationDetector::test_valid_element_reference PASSED [ 48%]
tests/test_error_validation.py::TestHallucinationDetector::test_wrong_coordinates_detection PASSED [ 48%]
tests/test_error_validation.py::TestHallucinationDetector::test_fabricated_data_patterns PASSED [ 48%]
tests/test_error_validation.py::TestActionValidator::test_default_rules_setup PASSED [ 48%]
tests/test_error_validation.py::TestActionValidator::test_add_custom_rule PASSED [ 49%]
tests/test_error_validation.py::TestActionValidator::test_validate_valid_action PASSED [ 49%]
tests/test_error_validation.py::TestActionValidator::test_validate_low_confidence_coordinates PASSED [ 49%]
tests/test_error_validation.py::TestActionValidator::test_validate_prerequisites_not_met PASSED [ 49%]
tests/test_error_validation.py::TestActionValidator::test_validate_action_type PASSED [ 50%]
tests/test_error_validation.py::TestActionValidator::test_validate_target PASSED [ 50%]
tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_type_with_successful_focus_on_first_click FAILED [ 50%]
tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_type_with_double_click_strategy FAILED [ 50%]
tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_type_with_long_wait_strategy FAILED [ 51%]
tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_type_fails_when_element_not_focusable FAILED [ 51%]
tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_validation_checks_focusability_for_type_actions FAILED [ 51%]
tests/test_fix_typing_action.py::TestClickWithFocus::test_click_action_uses_enhanced_focus FAILED [ 51%]
tests/test_formatters.py::TestTestPlanFormatter::test_to_json_pretty PASSED [ 52%]
tests/test_formatters.py::TestTestPlanFormatter::test_to_json_compact PASSED [ 52%]
tests/test_formatters.py::TestTestPlanFormatter::test_to_markdown PASSED [ 52%]
tests/test_formatters.py::TestTestPlanFormatter::test_from_json PASSED   [ 52%]
tests/test_formatters.py::TestTestPlanFormatter::test_to_dict PASSED     [ 53%]
tests/test_formatters.py::TestTestPlanFormatter::test_markdown_no_optional_fields PASSED [ 53%]
tests/test_grid_overlay.py::TestGridOverlay::test_initialization PASSED  [ 53%]
tests/test_grid_overlay.py::TestGridOverlay::test_initialize_dimensions PASSED [ 54%]
tests/test_grid_overlay.py::TestGridOverlay::test_coordinate_to_pixels_center PASSED [ 54%]
tests/test_grid_overlay.py::TestGridOverlay::test_coordinate_to_pixels_with_offset PASSED [ 54%]
tests/test_grid_overlay.py::TestGridOverlay::test_coordinate_to_pixels_not_initialized PASSED [ 54%]
tests/test_grid_overlay.py::TestGridOverlay::test_get_cell_bounds PASSED [ 55%]
tests/test_grid_overlay.py::TestGridOverlay::test_get_cell_from_pixel PASSED [ 55%]
tests/test_grid_overlay.py::TestGridOverlay::test_cell_naming PASSED     [ 55%]
tests/test_grid_overlay.py::TestGridOverlay::test_parse_cell_identifier PASSED [ 55%]
tests/test_grid_overlay.py::TestGridOverlay::test_get_neighboring_cells PASSED [ 56%]
tests/test_grid_overlay.py::TestGridOverlay::test_get_refinement_region PASSED [ 56%]
tests/test_grid_overlay.py::TestGridOverlay::test_create_overlay_image PASSED [ 56%]
tests/test_grid_overlay.py::TestGridOverlay::test_grid_bounds_clamping PASSED [ 56%]
tests/test_grid_refinement.py::TestGridRefinement::test_initialization PASSED [ 57%]
tests/test_grid_refinement.py::TestGridRefinement::test_should_refine_enabled PASSED [ 57%]
tests/test_grid_refinement.py::TestGridRefinement::test_should_refine_disabled PASSED [ 57%]
tests/test_grid_refinement.py::TestGridRefinement::test_refine_coordinate_high_confidence PASSED [ 57%]
tests/test_grid_refinement.py::TestGridRefinement::test_refine_coordinate_low_confidence PASSED [ 58%]
tests/test_grid_refinement.py::TestGridRefinement::test_refine_coordinate_disabled PASSED [ 58%]
tests/test_grid_refinement.py::TestGridRefinement::test_crop_refinement_region PASSED [ 58%]
tests/test_grid_refinement.py::TestGridRefinement::test_create_refinement_overlay PASSED [ 58%]
tests/test_grid_refinement.py::TestGridRefinement::test_calculate_refined_pixel_position PASSED [ 59%]
tests/test_grid_refinement.py::TestGridRefinement::test_refinement_edge_cases PASSED [ 59%]
tests/test_journal_manager.py::TestJournalManager::test_create_journal PASSED [ 59%]
tests/test_journal_manager.py::TestJournalManager::test_record_action_visual PASSED [ 60%]
tests/test_journal_manager.py::TestJournalManager::test_record_action_scripted PASSED [ 60%]
tests/test_journal_manager.py::TestJournalManager::test_pattern_creation_high_confidence PASSED [ 60%]
tests/test_journal_manager.py::TestJournalManager::test_pattern_not_created_low_confidence PASSED [ 60%]
tests/test_journal_manager.py::TestJournalManager::test_find_matching_pattern PASSED [ 61%]
tests/test_journal_manager.py::TestJournalManager::test_finalize_journal PASSED [ 61%]
tests/test_journal_manager.py::TestJournalManager::test_get_journal PASSED [ 61%]
tests/test_journal_manager.py::TestJournalManager::test_pattern_library_stats PASSED [ 61%]
tests/test_journal_manager.py::TestJournalManager::test_shutdown PASSED  [ 62%]
tests/test_journal_manager.py::TestJournalManager::test_error_handling_invalid_journal_id PASSED [ 62%]
tests/test_journal_models.py::TestJournalEntry::test_create_journal_entry PASSED [ 62%]
tests/test_journal_models.py::TestJournalEntry::test_journal_entry_with_grid_coordinates PASSED [ 62%]
tests/test_journal_models.py::TestJournalEntry::test_journal_entry_with_scripted_command PASSED [ 63%]
tests/test_journal_models.py::TestActionRecord::test_create_action_record PASSED [ 63%]
tests/test_journal_models.py::TestActionRecord::test_action_record_with_fallbacks PASSED [ 63%]
tests/test_journal_models.py::TestPatternMatch::test_create_pattern_match PASSED [ 63%]
tests/test_journal_models.py::TestPatternMatch::test_pattern_match_confidence_validation PASSED [ 64%]
tests/test_journal_models.py::TestScriptedCommand::test_create_scripted_command PASSED [ 64%]
tests/test_journal_models.py::TestScriptedCommand::test_scripted_command_fallback_settings PASSED [ 64%]
tests/test_journal_models.py::TestExecutionJournal::test_create_execution_journal PASSED [ 64%]
tests/test_journal_models.py::TestExecutionJournal::test_add_entry_to_journal PASSED [ 65%]
tests/test_journal_models.py::TestExecutionJournal::test_finalize_journal PASSED [ 65%]
tests/test_journal_models.py::TestExecutionJournal::test_journal_summary PASSED [ 65%]
tests/test_journal_models.py::TestExecutionJournal::test_journal_with_patterns PASSED [ 65%]
tests/test_main.py::test_api_connection <- src/main.py PASSED            [ 66%]
tests/test_main.py::TestCLIParser::test_parser_creation PASSED           [ 66%]
tests/test_main.py::TestCLIParser::test_requirements_is_action PASSED    [ 66%]
tests/test_main.py::TestCLIParser::test_mutually_exclusive_inputs PASSED [ 67%]
tests/test_main.py::TestUtilityCommands::test_show_version PASSED        [ 67%]
tests/test_main.py::TestUtilityCommands::test_api_connection_success PASSED [ 67%]
tests/test_main.py::TestUtilityCommands::test_api_connection_failure PASSED [ 67%]
tests/test_main.py::TestInteractiveMode::test_get_interactive_requirements PASSED [ 68%]
tests/test_main.py::TestInteractiveMode::test_get_interactive_requirements_no_input PASSED [ 68%]
tests/test_main.py::TestPlanFileProcessing::test_process_plan_file_not_found PASSED [ 68%]
tests/test_main.py::TestPlanFileProcessing::test_process_plan_file_success FAILED [ 68%]
tests/test_main.py::TestPlanFileProcessing::test_process_plan_file_berserk_mode PASSED [ 69%]
tests/test_main.py::TestMainFlow::test_version_command PASSED            [ 69%]
tests/test_main.py::TestMainFlow::test_test_api_command PASSED           [ 69%]
tests/test_main.py::TestMainFlow::test_requirements_mode PASSED          [ 69%]
tests/test_main.py::TestMainFlow::test_plan_mode PASSED                  [ 70%]
tests/test_main.py::TestMainFlow::test_berserk_mode_flag PASSED          [ 70%]
tests/test_main.py::TestMainFlow::test_json_test_plan_mode PASSED        [ 70%]
tests/test_main.py::TestMainFlow::test_no_input_shows_help PASSED        [ 70%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_exact_match PASSED [ 71%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_similar_match PASSED [ 71%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_partial_match PASSED [ 71%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_no_match_different_action_type PASSED [ 71%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_no_match_low_confidence PASSED [ 72%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_text_similarity PASSED [ 72%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_url_similarity PASSED [ 72%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_visual_similarity PASSED [ 72%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_rank_patterns PASSED [ 73%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_update_pattern_performance PASSED [ 73%]
tests/test_pattern_matcher.py::TestPatternMatcher::test_extract_domain_and_path PASSED [ 73%]
tests/test_rate_limiter.py::TestTokenBucket::test_token_bucket_creation PASSED [ 74%]
tests/test_rate_limiter.py::TestTokenBucket::test_acquire_tokens PASSED  [ 74%]
tests/test_rate_limiter.py::TestTokenBucket::test_token_refill PASSED    [ 74%]
tests/test_rate_limiter.py::TestTokenBucket::test_acquire_or_wait PASSED [ 74%]
tests/test_rate_limiter.py::TestTokenBucket::test_acquire_or_wait_timeout PASSED [ 75%]
tests/test_rate_limiter.py::TestSlidingWindowCounter::test_sliding_window_creation PASSED [ 75%]
tests/test_rate_limiter.py::TestSlidingWindowCounter::test_request_counting PASSED [ 75%]
tests/test_rate_limiter.py::TestSlidingWindowCounter::test_window_expiry PASSED [ 75%]
tests/test_rate_limiter.py::TestRateLimiter::test_rate_limiter_creation PASSED [ 76%]
tests/test_rate_limiter.py::TestRateLimiter::test_api_rate_limiting PASSED [ 76%]
tests/test_rate_limiter.py::TestRateLimiter::test_browser_action_limiting PASSED [ 76%]
tests/test_rate_limiter.py::TestRateLimiter::test_wait_for_limit PASSED  [ 76%]
tests/test_rate_limiter.py::TestRateLimiter::test_disabled_rate_limiting PASSED [ 77%]
tests/test_rate_limiter.py::TestRateLimiter::test_statistics PASSED      [ 77%]
tests/test_rate_limiter.py::TestRateLimiter::test_sliding_window_strategy PASSED [ 77%]
tests/test_sanitizer.py::TestSensitiveDataPattern::test_pattern_creation PASSED [ 77%]
tests/test_sanitizer.py::TestSensitiveDataPattern::test_pattern_matching PASSED [ 78%]
tests/test_sanitizer.py::TestSensitiveDataPattern::test_disabled_pattern PASSED [ 78%]
tests/test_sanitizer.py::TestDataSanitizer::test_default_patterns PASSED [ 78%]
tests/test_sanitizer.py::TestDataSanitizer::test_sanitize_api_keys PASSED [ 78%]
tests/test_sanitizer.py::TestDataSanitizer::test_sanitize_credit_cards PASSED [ 79%]
tests/test_sanitizer.py::TestDataSanitizer::test_sanitize_personal_info PASSED [ 79%]
tests/test_sanitizer.py::TestDataSanitizer::test_redaction_methods PASSED [ 79%]
tests/test_sanitizer.py::TestDataSanitizer::test_sanitize_dict PASSED    [ 80%]
tests/test_sanitizer.py::TestDataSanitizer::test_nested_dict_sanitization PASSED [ 80%]
tests/test_sanitizer.py::TestDataSanitizer::test_list_sanitization PASSED [ 80%]
tests/test_sanitizer.py::TestDataSanitizer::test_custom_sanitizer PASSED [ 80%]
tests/test_sanitizer.py::TestDataSanitizer::test_sanitize_log_record PASSED [ 81%]
tests/test_sanitizer.py::TestDataSanitizer::test_statistics PASSED       [ 81%]
tests/test_sanitizer.py::TestConvenienceFunctions::test_sanitize_string_function PASSED [ 81%]
tests/test_sanitizer.py::TestConvenienceFunctions::test_sanitize_dict_function PASSED [ 81%]
tests/test_sanitizer.py::TestConvenienceFunctions::test_mask_sensitive_data PASSED [ 82%]
tests/test_script_recorder.py::TestScriptRecorder::test_record_click_action PASSED [ 82%]
tests/test_script_recorder.py::TestScriptRecorder::test_record_type_action PASSED [ 82%]
tests/test_script_recorder.py::TestScriptRecorder::test_record_navigate_action PASSED [ 82%]
tests/test_script_recorder.py::TestScriptRecorder::test_record_failed_action PASSED [ 83%]
tests/test_script_recorder.py::TestScriptRecorder::test_generate_selectors_priority PASSED [ 83%]
tests/test_script_recorder.py::TestScriptRecorder::test_generate_selectors_minimal_info PASSED [ 83%]
tests/test_script_recorder.py::TestScriptRecorder::test_create_fallback_scripts PASSED [ 83%]
tests/test_script_recorder.py::TestScriptRecorder::test_record_scroll_action PASSED [ 84%]
tests/test_script_recorder.py::TestScriptRecorder::test_record_wait_action PASSED [ 84%]
tests/test_script_recorder.py::TestScriptRecorder::test_text_selector_escaping PASSED [ 84%]
tests/test_script_recorder.py::TestScriptRecorder::test_xpath_selector_generation PASSED [ 84%]
tests/test_script_recorder.py::TestScriptRecorder::test_replace_selector PASSED [ 85%]
tests/test_script_recorder.py::TestScriptRecorder::test_unknown_action_type PASSED [ 85%]
tests/test_scroll_actions.py::TestScrollActions::test_scroll_by_pixels_workflow PASSED [ 85%]
tests/test_scroll_actions.py::TestScrollActions::test_scroll_to_top_workflow PASSED [ 85%]
tests/test_scroll_actions.py::TestScrollActions::test_scroll_to_bottom_workflow PASSED [ 86%]
tests/test_scroll_actions.py::TestScrollActions::test_scroll_horizontal_workflow PASSED [ 86%]
tests/test_scroll_actions.py::TestScrollActions::test_calculate_scroll_distance PASSED [ 86%]
tests/test_scroll_actions.py::TestScrollActions::test_detect_overshoot PASSED [ 87%]
tests/test_scroll_actions.py::TestScrollActions::test_is_oscillating PASSED [ 87%]
tests/test_scroll_actions.py::TestScrollActions::test_parse_visibility_response PASSED [ 87%]
tests/test_scroll_actions.py::TestScrollToElement::test_scroll_to_element_immediate_success PASSED [ 87%]
tests/test_scroll_actions.py::TestScrollToElement::test_scroll_to_element_with_scrolling PASSED [ 88%]
tests/test_scroll_actions.py::TestScrollToElement::test_scroll_to_element_max_attempts PASSED [ 88%]
tests/test_scroll_actions.py::TestScrollToElement::test_scroll_to_element_with_overshoot_correction PASSED [ 88%]
tests/test_scroll_actions.py::TestBrowserDriverScrollMethods::test_browser_scroll_by_pixels PASSED [ 88%]
tests/test_scroll_actions.py::TestBrowserDriverScrollMethods::test_browser_scroll_to_top PASSED [ 89%]
tests/test_scroll_actions.py::TestBrowserDriverScrollMethods::test_browser_scroll_to_bottom PASSED [ 89%]
tests/test_scroll_actions.py::TestBrowserDriverScrollMethods::test_browser_get_scroll_position PASSED [ 89%]
tests/test_scroll_actions.py::TestBrowserDriverScrollMethods::test_browser_get_page_dimensions PASSED [ 89%]
tests/test_state_manager.py::TestStateManager::test_create_test_state PASSED [ 90%]
tests/test_state_manager.py::TestStateManager::test_update_test_state_start PASSED [ 90%]
tests/test_state_manager.py::TestStateManager::test_update_test_state_complete_step PASSED [ 90%]
tests/test_state_manager.py::TestStateManager::test_update_test_state_fail_step PASSED [ 90%]
tests/test_state_manager.py::TestStateManager::test_update_test_state_skip_step PASSED [ 91%]
tests/test_state_manager.py::TestStateManager::test_update_test_state_pause_resume PASSED [ 91%]
tests/test_state_manager.py::TestStateManager::test_update_test_state_complete PASSED [ 91%]
tests/test_state_manager.py::TestStateManager::test_update_test_state_abort PASSED [ 91%]
tests/test_state_manager.py::TestStateManager::test_invalid_transition PASSED [ 92%]
tests/test_state_manager.py::TestStateManager::test_nonexistent_test_state PASSED [ 92%]
tests/test_state_manager.py::TestStateManager::test_register_unregister_agent PASSED [ 92%]
tests/test_state_manager.py::TestStateManager::test_get_test_progress PASSED [ 92%]
tests/test_state_manager.py::TestStateManager::test_state_change_callbacks PASSED [ 93%]
tests/test_state_manager.py::TestStateManager::test_get_state_history PASSED [ 93%]
tests/test_state_manager.py::TestStateManager::test_step_results_storage PASSED [ 93%]
tests/test_state_manager.py::TestStateManager::test_cleanup_test PASSED  [ 94%]
tests/test_state_manager.py::TestStateManager::test_check_dependencies PASSED [ 94%]
tests/test_state_manager.py::TestStateManager::test_history_limit PASSED [ 94%]
tests/test_state_manager.py::TestStateManager::test_shutdown PASSED      [ 94%]
tests/test_test_planner.py::TestTestPlannerAgent::test_initialization PASSED [ 95%]
tests/test_test_planner.py::TestTestPlannerAgent::test_create_test_plan_basic PASSED [ 95%]
tests/test_test_planner.py::TestTestPlannerAgent::test_create_test_plan_with_context PASSED [ 95%]
tests/test_test_planner.py::TestTestPlannerAgent::test_test_plan_steps_structure PASSED [ 95%]
tests/test_test_planner.py::TestTestPlannerAgent::test_parse_test_plan_response_error PASSED [ 96%]
tests/test_test_planner.py::TestTestPlannerAgent::test_refine_test_plan PASSED [ 96%]
tests/test_test_planner.py::TestTestPlannerAgent::test_serialize_test_plan PASSED [ 96%]
tests/test_test_planner.py::TestTestPlannerAgent::test_extract_test_scenarios PASSED [ 96%]
tests/test_test_planner.py::TestTestPlannerAgent::test_extract_test_scenarios_error PASSED [ 97%]
tests/test_test_planner.py::TestTestPlannerAgent::test_build_requirements_message PASSED [ 97%]
tests/test_test_planner.py::TestTestPlannerAgent::test_build_requirements_message_with_context PASSED [ 97%]
tests/test_test_planner.py::TestTestPlannerAgent::test_openai_call_parameters PASSED [ 97%]
tests/test_test_runner.py::TestEnhancedTestRunner::test_execute_test_plan_success PASSED [ 98%]
tests/test_test_runner.py::TestEnhancedTestRunner::test_execute_test_plan_with_failure FAILED [ 98%]
tests/test_test_runner.py::TestEnhancedTestRunner::test_intelligent_step_interpretation PASSED [ 98%]
tests/test_test_runner.py::TestEnhancedTestRunner::test_bug_report_generation FAILED [ 98%]
tests/test_test_runner.py::TestEnhancedTestRunner::test_living_document_updates PASSED [ 99%]
tests/test_test_runner.py::TestEnhancedTestRunner::test_failure_classification PASSED [ 99%]
tests/test_test_runner.py::TestEnhancedTestRunner::test_summary_calculation PASSED [ 99%]
tests/test_test_runner.py::TestEnhancedTestRunner::test_cascade_failure_handling PASSED [100%]/usr/lib/python3.12/ast.py:52: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
  return compile(source, filename, mode, flags,
RuntimeWarning: Enable tracemalloc to get the object allocation traceback


==================================== ERRORS ====================================
____ ERROR at setup of TestEndToEndIntegration.test_main_with_requirements _____
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
    requirements_source
      Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
    test_cases
      Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
____ ERROR at setup of TestEndToEndIntegration.test_main_with_scenario_file ____
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
    requirements_source
      Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
    test_cases
      Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
___ ERROR at setup of TestEndToEndIntegration.test_test_reporter_integration ___
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
    requirements_source
      Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
    test_cases
      Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestBugReportCreation.test_create_bug_report_from_failed_step _
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
    requirements_source
      Field required [type=missing, input_value={'plan_id': UUID('d252ecf...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
    test_cases
      Field required [type=missing, input_value={'plan_id': UUID('d252ecf...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestBugReportCreation.test_no_bug_report_for_successful_step _
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
    requirements_source
      Field required [type=missing, input_value={'plan_id': UUID('ed9bfdc...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
    test_cases
      Field required [type=missing, input_value={'plan_id': UUID('ed9bfdc...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
_______ ERROR at setup of TestBugReportCreation.test_bug_report_summary ________
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
    requirements_source
      Field required [type=missing, input_value={'plan_id': UUID('e66f9b7...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
    test_cases
      Field required [type=missing, input_value={'plan_id': UUID('e66f9b7...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
______ ERROR at setup of TestSimpleHTMLReporter.test_generate_html_report ______
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
    requirements_source
      Field required [type=missing, input_value={'plan_id': UUID('a3f06b5...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
    test_cases
      Field required [type=missing, input_value={'plan_id': UUID('a3f06b5...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
______ ERROR at setup of TestSimpleHTMLReporter.test_report_without_bugs _______
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
    requirements_source
      Field required [type=missing, input_value={'plan_id': UUID('c56b442...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
    test_cases
      Field required [type=missing, input_value={'plan_id': UUID('c56b442...['search', 'wikipedia']}, input_type=dict]
        For further information visit https://errors.pydantic.dev/2.11/v/missing
=================================== FAILURES ===================================
/home/fkeegan/src/haindy/tests/test_base_agent.py:36: AssertionError: assert 'o4-mini-2025-04-16' == 'gpt-4o-mini'
/usr/lib/python3.12/unittest/mock.py:944: AssertionError: expected call not found.
/home/fkeegan/src/haindy/tests/test_communication.py:289: AssertionError: assert False
/home/fkeegan/src/haindy/tests/test_end_to_end_integration.py:278: pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
/home/fkeegan/src/haindy/src/agents/action_agent.py:281: AttributeError: 'NoneType' object has no attribute 'action_type'
/home/fkeegan/src/haindy/src/agents/action_agent.py:281: AttributeError: 'NoneType' object has no attribute 'action_type'
/home/fkeegan/src/haindy/src/agents/action_agent.py:281: AttributeError: 'NoneType' object has no attribute 'action_type'
/home/fkeegan/src/haindy/src/agents/action_agent.py:281: AttributeError: 'NoneType' object has no attribute 'action_type'
/home/fkeegan/src/haindy/src/agents/action_agent.py:281: AttributeError: 'NoneType' object has no attribute 'action_type'
/home/fkeegan/src/haindy/src/agents/action_agent.py:281: AttributeError: 'NoneType' object has no attribute 'action_type'
/home/fkeegan/src/haindy/tests/test_main.py:190: assert 1 == 0
/home/fkeegan/src/haindy/tests/test_test_runner.py:510: AssertionError: assert <TestStatus.COMPLETED: 'completed'> == <TestStatus.FAILED: 'failed'>
/usr/lib/python3.12/json/__init__.py:339: TypeError: the JSON object must be str, bytes or bytearray, not coroutine
=============================== warnings summary ===============================
src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_action_agent.py)
    class TestStep(BaseModel):

src/monitoring/analytics.py:58
  /home/fkeegan/src/haindy/src/monitoring/analytics.py:58: PytestCollectionWarning: cannot collect test class 'TestMetrics' because it has a __init__ constructor (from: tests/test_analytics.py)
    @dataclass

src/monitoring/analytics.py:33
  /home/fkeegan/src/haindy/src/monitoring/analytics.py:33: PytestCollectionWarning: cannot collect test class 'TestOutcome' because it has a __init__ constructor (from: tests/test_analytics.py)
    class TestOutcome(Enum):

src/core/types.py:150
  /home/fkeegan/src/haindy/src/core/types.py:150: PytestCollectionWarning: cannot collect test class 'TestPlan' because it has a __init__ constructor (from: tests/test_coordinator.py)
    class TestPlan(BaseModel):

src/core/types.py:136
  /home/fkeegan/src/haindy/src/core/types.py:136: PytestCollectionWarning: cannot collect test class 'TestCase' because it has a __init__ constructor (from: tests/test_coordinator.py)
    class TestCase(BaseModel):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_coordinator.py)
    class TestStep(BaseModel):

src/core/types.py:166
  /home/fkeegan/src/haindy/src/core/types.py:166: PytestCollectionWarning: cannot collect test class 'TestState' because it has a __init__ constructor (from: tests/test_coordinator.py)
    class TestState(BaseModel):

src/core/types.py:13
  /home/fkeegan/src/haindy/src/core/types.py:13: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_coordinator.py)
    class TestStatus(str, Enum):

src/core/types.py:150
  /home/fkeegan/src/haindy/src/core/types.py:150: PytestCollectionWarning: cannot collect test class 'TestPlan' because it has a __init__ constructor (from: tests/test_core_types.py)
    class TestPlan(BaseModel):

src/core/types.py:166
  /home/fkeegan/src/haindy/src/core/types.py:166: PytestCollectionWarning: cannot collect test class 'TestState' because it has a __init__ constructor (from: tests/test_core_types.py)
    class TestState(BaseModel):

src/core/types.py:13
  /home/fkeegan/src/haindy/src/core/types.py:13: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_core_types.py)
    class TestStatus(str, Enum):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_core_types.py)
    class TestStep(BaseModel):

src/core/types.py:166
  /home/fkeegan/src/haindy/src/core/types.py:166: PytestCollectionWarning: cannot collect test class 'TestState' because it has a __init__ constructor (from: tests/test_end_to_end_integration.py)
    class TestState(BaseModel):

src/core/types.py:13
  /home/fkeegan/src/haindy/src/core/types.py:13: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_end_to_end_integration.py)
    class TestStatus(str, Enum):

src/monitoring/reporter.py:558
  /home/fkeegan/src/haindy/src/monitoring/reporter.py:558: PytestCollectionWarning: cannot collect test class 'TestReporter' because it has a __init__ constructor (from: tests/test_end_to_end_integration.py)
    class TestReporter:

src/core/types.py:150
  /home/fkeegan/src/haindy/src/core/types.py:150: PytestCollectionWarning: cannot collect test class 'TestPlan' because it has a __init__ constructor (from: tests/test_enhanced_error_reporting.py)
    class TestPlan(BaseModel):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_enhanced_error_reporting.py)
    class TestStep(BaseModel):

src/core/types.py:166
  /home/fkeegan/src/haindy/src/core/types.py:166: PytestCollectionWarning: cannot collect test class 'TestState' because it has a __init__ constructor (from: tests/test_enhanced_error_reporting.py)
    class TestState(BaseModel):

src/core/types.py:13
  /home/fkeegan/src/haindy/src/core/types.py:13: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_enhanced_error_reporting.py)
    class TestStatus(str, Enum):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_enhanced_types.py)
    class TestStep(BaseModel):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_fix_typing_action.py)
    class TestStep(BaseModel):

src/core/types.py:136
  /home/fkeegan/src/haindy/src/core/types.py:136: PytestCollectionWarning: cannot collect test class 'TestCase' because it has a __init__ constructor (from: tests/test_formatters.py)
    class TestCase(BaseModel):

src/core/types.py:127
  /home/fkeegan/src/haindy/src/core/types.py:127: PytestCollectionWarning: cannot collect test class 'TestCasePriority' because it has a __init__ constructor (from: tests/test_formatters.py)
    class TestCasePriority(str, Enum):

src/core/types.py:150
  /home/fkeegan/src/haindy/src/core/types.py:150: PytestCollectionWarning: cannot collect test class 'TestPlan' because it has a __init__ constructor (from: tests/test_formatters.py)
    class TestPlan(BaseModel):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_formatters.py)
    class TestStep(BaseModel):

src/core/types.py:150
  /home/fkeegan/src/haindy/src/core/types.py:150: PytestCollectionWarning: cannot collect test class 'TestPlan' because it has a __init__ constructor (from: tests/test_journal_manager.py)
    class TestPlan(BaseModel):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_journal_manager.py)
    class TestStep(BaseModel):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_scroll_actions.py)
    class TestStep(BaseModel):

src/core/types.py:13
  /home/fkeegan/src/haindy/src/core/types.py:13: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_scroll_actions.py)
    class TestStatus(str, Enum):

src/core/types.py:150
  /home/fkeegan/src/haindy/src/core/types.py:150: PytestCollectionWarning: cannot collect test class 'TestPlan' because it has a __init__ constructor (from: tests/test_state_manager.py)
    class TestPlan(BaseModel):

src/core/types.py:166
  /home/fkeegan/src/haindy/src/core/types.py:166: PytestCollectionWarning: cannot collect test class 'TestState' because it has a __init__ constructor (from: tests/test_state_manager.py)
    class TestState(BaseModel):

src/core/types.py:13
  /home/fkeegan/src/haindy/src/core/types.py:13: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_state_manager.py)
    class TestStatus(str, Enum):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_state_manager.py)
    class TestStep(BaseModel):

src/agents/test_planner.py:19
  /home/fkeegan/src/haindy/src/agents/test_planner.py:19: PytestCollectionWarning: cannot collect test class 'TestPlannerAgent' because it has a __init__ constructor (from: tests/test_test_planner.py)
    class TestPlannerAgent(BaseAgent):

src/core/types.py:136
  /home/fkeegan/src/haindy/src/core/types.py:136: PytestCollectionWarning: cannot collect test class 'TestCase' because it has a __init__ constructor (from: tests/test_test_planner.py)
    class TestCase(BaseModel):

src/core/types.py:127
  /home/fkeegan/src/haindy/src/core/types.py:127: PytestCollectionWarning: cannot collect test class 'TestCasePriority' because it has a __init__ constructor (from: tests/test_test_planner.py)
    class TestCasePriority(str, Enum):

src/core/types.py:150
  /home/fkeegan/src/haindy/src/core/types.py:150: PytestCollectionWarning: cannot collect test class 'TestPlan' because it has a __init__ constructor (from: tests/test_test_planner.py)
    class TestPlan(BaseModel):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_test_planner.py)
    class TestStep(BaseModel):

src/agents/test_runner.py:42
  /home/fkeegan/src/haindy/src/agents/test_runner.py:42: PytestCollectionWarning: cannot collect test class 'TestRunner' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestRunner(BaseAgent):

src/core/types.py:136
  /home/fkeegan/src/haindy/src/core/types.py:136: PytestCollectionWarning: cannot collect test class 'TestCase' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestCase(BaseModel):

src/core/types.py:127
  /home/fkeegan/src/haindy/src/core/types.py:127: PytestCollectionWarning: cannot collect test class 'TestCasePriority' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestCasePriority(str, Enum):

src/core/types.py:357
  /home/fkeegan/src/haindy/src/core/types.py:357: PytestCollectionWarning: cannot collect test class 'TestCaseResult' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestCaseResult(BaseModel):

src/core/types.py:150
  /home/fkeegan/src/haindy/src/core/types.py:150: PytestCollectionWarning: cannot collect test class 'TestPlan' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestPlan(BaseModel):

src/core/types.py:391
  /home/fkeegan/src/haindy/src/core/types.py:391: PytestCollectionWarning: cannot collect test class 'TestReport' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestReport(BaseModel):

src/core/types.py:166
  /home/fkeegan/src/haindy/src/core/types.py:166: PytestCollectionWarning: cannot collect test class 'TestState' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestState(BaseModel):

src/core/types.py:13
  /home/fkeegan/src/haindy/src/core/types.py:13: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestStatus(str, Enum):

src/core/types.py:110
  /home/fkeegan/src/haindy/src/core/types.py:110: PytestCollectionWarning: cannot collect test class 'TestStep' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestStep(BaseModel):

src/core/types.py:374
  /home/fkeegan/src/haindy/src/core/types.py:374: PytestCollectionWarning: cannot collect test class 'TestSummary' because it has a __init__ constructor (from: tests/test_test_runner.py)
    class TestSummary(BaseModel):

tests/test_coordinator.py::TestWorkflowCoordinatorTestExecution::test_generate_test_plan_method
  /usr/lib/python3.12/asyncio/base_events.py:1988: RuntimeWarning: coroutine 'WorkflowCoordinator._handle_plan_request' was never awaited
    handle = None  # Needed to break cycles when an exception occurs.
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                     Stmts   Miss  Cover   Missing
----------------------------------------------------------------------
src/__init__.py                              0      0   100%
src/agents/__init__.py                       5      0   100%
src/agents/action_agent.py                1233    876    29%   115-157, 168-196, 209-224, 236-250, 297, 301, 303, 305, 308-319, 337-577, 607-938, 957-1481, 1487-1605, 1611-1803, 1809-2200, 2208-2363, 2420, 2449, 2540-2541, 2575, 2611-2620, 2630-2699, 2725-2802, 2826-2860, 2877-2950, 2966-2970, 2995-3041, 3056-3129, 3133-3155, 3250-3257, 3293-3302, 3402, 3429, 3439, 3463-3464, 3475, 3477, 3563-3566, 3603-3604, 3617-3618, 3624-3625, 3631-3632, 3638-3639, 3647-3648, 3686, 3692-3701, 3731-3740, 3800-3809, 3870-3879, 3922-3926, 3957-3966
src/agents/base_agent.py                    59      2    97%   86, 101
src/agents/formatters.py                    93      4    96%   130, 150-152
src/agents/test_planner.py                  87      1    99%   157
src/agents/test_runner.py                  440     66    85%   193-200, 240-242, 265-270, 280-289, 326-328, 388-390, 393-406, 547, 610-615, 652, 663, 668, 670, 674-682, 693, 822-824, 843, 890-896, 901, 914, 944-959, 964, 979, 1009, 1046, 1060, 1077, 1179, 1204-1206
src/browser/__init__.py                      3      0   100%
src/browser/controller.py                   80     10    88%   62, 68-71, 89, 93-94, 132, 139, 169
src/browser/driver.py                      153     52    66%   104, 117, 124-128, 132-136, 140-169, 181, 199, 207, 220, 235, 255, 263-264, 269, 281-285, 290, 297, 304, 313-316, 320-321, 325
src/config/__init__.py                       2      0   100%
src/config/agent_prompts.py                 14      3    79%   186, 197, 210
src/config/settings.py                      77      1    99%   198
src/core/__init__.py                         3      0   100%
src/core/enhanced_types.py                 127     15    88%   295-316
src/core/interfaces.py                      85     22    74%   47, 72, 92, 108, 128, 144, 154, 159, 164, 169, 174, 179, 184, 200, 213, 226, 239, 256, 272, 281, 286, 291
src/core/types.py                          255      0   100%
src/error_handling/__init__.py               5      0   100%
src/error_handling/aggregator.py           133      2    98%   249, 261
src/error_handling/exceptions.py            69      0   100%
src/error_handling/recovery.py             143      7    95%   72, 77, 126, 210, 235-236, 310
src/error_handling/validation.py           163     19    88%   120, 132-150, 271, 346, 351-353, 373, 450
src/evaluation/__init__.py                   4      4     0%   8-12
src/evaluation/confidence.py                66     66     0%   7-209
src/evaluation/error_detection.py           77     77     0%   8-199
src/evaluation/validators.py               103    103     0%   7-269
src/grid/__init__.py                         3      0   100%
src/grid/overlay.py                        137      7    95%   52, 109, 155-156, 188, 309-310
src/grid/refinement.py                      81      0   100%
src/journal/__init__.py                      6      0   100%
src/journal/adapters.py                     73     67     8%   30-98, 123-171
src/journal/dual_mode_executor.py          102     83    19%   40-45, 69-135, 157-202, 216-224, 233-255, 267-300, 306, 310-312
src/journal/manager.py                     174     34    80%   118-127, 139, 204, 215, 230, 258, 324, 338-343, 392-393, 401-403, 410-420, 439-440, 449-450
src/journal/models.py                      136      0   100%
src/journal/pattern_matcher.py             122      9    93%   151, 173-174, 201, 208, 236-237, 248-249
src/journal/script_recorder.py             144     19    87%   56-57, 149, 153, 179, 183, 210, 215, 240, 243, 265, 282-288, 332, 345, 369
src/main.py                                277     93    66%   159-160, 162-163, 206-207, 244-263, 284-339, 344-350, 378-379, 421-422, 461-463, 497-500, 506-553, 573-574, 631-635, 639
src/models/__init__.py                       2      0   100%
src/models/openai_client.py                 70     36    49%   40, 73, 93, 98-100, 103, 114-118, 131-136, 157-178, 200-228, 242-262
src/monitoring/__init__.py                   4      0   100%
src/monitoring/analytics.py                176     18    90%   51, 160-161, 168, 196, 268-272, 291-292, 309, 355, 411-425, 456, 461
src/monitoring/debug_logger.py              84     52    38%   63-83, 104-119, 142-143, 152-159, 170-206, 215
src/monitoring/enhanced_reporter.py         70     70     0%   8-498
src/monitoring/logger.py                   105     38    64%   45, 49, 53, 66-69, 73-79, 89-92, 134-135, 145, 151-163, 202, 222-235, 255-267
src/monitoring/reporter.py                 215    172    20%   49-53, 57-108, 112, 116-126, 130-176, 189-217, 229-232, 241-253, 257, 276-285, 293-297, 301-324, 328-358, 567-569, 592-620, 625-653, 674-678
src/monitoring/simple_html_reporter.py      50     36    28%   484, 504-516, 525-604
src/orchestration/__init__.py                4      0   100%
src/orchestration/communication.py         138      8    94%   114, 245-246, 250, 334-337
src/orchestration/coordinator.py           151     39    74%   161-185, 193, 226-264, 337-339, 343-345, 349-351, 385, 414-417
src/orchestration/state_manager.py         173      7    96%   260, 279, 291, 347-349, 367
src/security/__init__.py                     3      0   100%
src/security/rate_limiter.py               182     23    87%   152, 156, 208-218, 306, 310, 331, 344-347, 360-361, 407, 412-414
src/security/sanitizer.py                  137     10    93%   219, 241, 277-279, 294, 319-320, 337, 381
----------------------------------------------------------------------
TOTAL                                     6298   2151    66%
Coverage HTML written to dir htmlcov
Required test coverage of 60% reached. Total coverage: 65.85%
=========================== short test summary info ============================
FAILED tests/test_base_agent.py::TestBaseAgent::test_default_initialization - AssertionError: assert 'o4-mini-2025-04-16' == 'gpt-4o-mini'
  
  - gpt-4o-mini
  + o4-mini-2025-04-16
FAILED tests/test_base_agent.py::TestBaseAgent::test_client_lazy_loading - AssertionError: expected call not found.
Expected: OpenAIClient(model='gpt-4o-mini')
  Actual: OpenAIClient(model='o4-mini-2025-04-16')
FAILED tests/test_communication.py::TestMessageTypes::test_message_types_defined - AssertionError: assert False
 +  where False = hasattr(MessageType, 'EVALUATE_RESULT')
FAILED tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_main_plan_only_mode - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
FAILED tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_type_with_successful_focus_on_first_click - AttributeError: 'NoneType' object has no attribute 'action_type'
FAILED tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_type_with_double_click_strategy - AttributeError: 'NoneType' object has no attribute 'action_type'
FAILED tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_type_with_long_wait_strategy - AttributeError: 'NoneType' object has no attribute 'action_type'
FAILED tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_type_fails_when_element_not_focusable - AttributeError: 'NoneType' object has no attribute 'action_type'
FAILED tests/test_fix_typing_action.py::TestEnhancedTypingAction::test_validation_checks_focusability_for_type_actions - AttributeError: 'NoneType' object has no attribute 'action_type'
FAILED tests/test_fix_typing_action.py::TestClickWithFocus::test_click_action_uses_enhanced_focus - AttributeError: 'NoneType' object has no attribute 'action_type'
FAILED tests/test_main.py::TestPlanFileProcessing::test_process_plan_file_success - assert 1 == 0
FAILED tests/test_test_runner.py::TestEnhancedTestRunner::test_execute_test_plan_with_failure - AssertionError: assert <TestStatus.COMPLETED: 'completed'> == <TestStatus.FAILED: 'failed'>
  
  - failed
  + completed
FAILED tests/test_test_runner.py::TestEnhancedTestRunner::test_bug_report_generation - TypeError: the JSON object must be str, bytes or bytearray, not coroutine
ERROR tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_main_with_requirements - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
ERROR tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_main_with_scenario_file - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
ERROR tests/test_end_to_end_integration.py::TestEndToEndIntegration::test_test_reporter_integration - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'name': 'Test Login Flow...=False, max_retries=3)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
ERROR tests/test_enhanced_error_reporting.py::TestBugReportCreation::test_create_bug_report_from_failed_step - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'plan_id': UUID('d252ecf...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'plan_id': UUID('d252ecf...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
ERROR tests/test_enhanced_error_reporting.py::TestBugReportCreation::test_no_bug_report_for_successful_step - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'plan_id': UUID('ed9bfdc...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'plan_id': UUID('ed9bfdc...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
ERROR tests/test_enhanced_error_reporting.py::TestBugReportCreation::test_bug_report_summary - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'plan_id': UUID('e66f9b7...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'plan_id': UUID('e66f9b7...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
ERROR tests/test_enhanced_error_reporting.py::TestSimpleHTMLReporter::test_generate_html_report - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'plan_id': UUID('a3f06b5...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'plan_id': UUID('a3f06b5...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
ERROR tests/test_enhanced_error_reporting.py::TestSimpleHTMLReporter::test_report_without_bugs - pydantic_core._pydantic_core.ValidationError: 2 validation errors for TestPlan
requirements_source
  Field required [type=missing, input_value={'plan_id': UUID('c56b442...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
test_cases
  Field required [type=missing, input_value={'plan_id': UUID('c56b442...['search', 'wikipedia']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
====== 13 failed, 363 passed, 1 skipped, 49 warnings, 8 errors in 48.94s =======
